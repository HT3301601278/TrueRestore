# 真迹还原系统 (Trace Restore System)

这是一个基于 Web 的 SVG 笔迹还原与动画生成工具。它可以将静态的 SVG 签名或书法作品，通过人工“临摹”录制笔顺，转化为带有真实书写感（笔锋、粗细变化）的动态 SVG 动画。

本项目基于 SVG `stroke-dashoffset` 动画原理，并结合了**蒙版技术**，解决了传统 SVG 描边动画无法处理复杂笔画的问题。

## 主要功能

- **可视化编辑器 (`index.html`)**：
  - **SVG 解析**：直接上传 SVG 文件，自动提取路径。
  - **笔画拆分**：支持将连笔或复合路径拆分为独立笔画，便于单独控制动画。
  - **笔迹录制**：在原字形上进行拖拽描绘，定义书写顺序和笔画粗细。
  - **节点微调**：支持对录制的路径进行节点级的推拉、增加、删除操作。
  - **项目保存**：导出为 `.json` 格式，包含原始路径和动画蒙版数据。
- **轻量级播放器 (`signature-player.js`)**：
  - 零依赖（仅需 React），基于 ESM 模块化设计。
  - **可配置**：支持控制是否循环播放、书写速度、停顿时间。
  - 真实还原笔锋效果。

## 快速开始

### 1. 启动编辑器

本项目是一个纯前端项目，无需复杂的构建流程。

直接在浏览器中打开 `index.html` 即可使用（建议使用 HTTP Server 运行，例如 VS Code 的 Live Server，以免遇到本地文件跨域限制）。

### 2. 准备 SVG 素材 (如果您没有现成文件)

如果您还没有 SVG 签名文件，可以通过以下步骤使用开源字体快速生成适合本系统的素材：

1.  **挑选字体样式**：
    访问 [Google Fonts](https://fonts.google.com/)，在筛选栏的 **Calligraphy** 中勾选 **"Handwriting"** (手写体)。浏览并记下您喜欢的字体名称。
2.  **生成 SVG 路径**：
    访问 [Google Font to SVG Path](https://danmarshall.github.io/google-font-to-svg-path/) 工具：
    - 在左上角下拉菜单中选择您刚才挑选的字体。
    - 在文本框输入您想要制作签名的文字内容。
    - **关键配置**：务必勾选 **"Separate characters"** (字符分离) 选项。这一步能确保每个汉字/字母是独立的路径，便于后续动画制作。
    - 点击下载按钮获取 SVG 文件。
3.  **上传**：
    回到本系统的编辑器，上传刚才生成的 SVG 文件即可。

### 3. 制作动画数据 (使用编辑器)

**步骤一：导入素材**

- 点击界面上的上传区域，选择你的 `.svg` 文件（或者之前保存的 `.json` 项目文件）。

**步骤二：预处理（拆分与排序）**

- **排序**：使用列表中的 `↑` `↓` 箭头调整笔画的书写顺序。
- **拆分**：如果一个 SVG Path 包含多个不连贯的笔画（例如“二”字是一个 Path），点击“剪刀”图标进入拆分模式。
  - 在弹窗中勾选属于同一笔画的片段，点击“合并选中”。
  - 确认无误后点击“确认拆分”。

**步骤三：录制笔迹（核心步骤）**

- 点击列表中的 **“录制” (或“编辑”)** 按钮进入全屏编辑模式。
- **调整笔刷**：根据原字形的粗细，拖动上方滑块调整笔刷大小。
- **绘制**：在灰色底图上，顺着笔画走向绘制线条。这根线条将作为“蒙版”来揭示底下的文字。
  - *技巧*：不需要画得非常完美，只需覆盖住原笔画即可。
- **微调**：
  - **拖动蓝点**：调整曲线形状。
  - **双击蓝点**：删除该控制点。
  - **双击线条**：在点击处增加控制点。
- 点击 **“保存”** 返回主界面。

**步骤四：预览与导出**

- 点击底部的 **播放** 按钮预览动画效果。
- 满意后，点击左侧的 **“保存当前进度 (.json)”**。这个 JSON 文件将用于网页播放。

## 接入网页 (使用播放器)

你可以参考 `player.html` 的写法，将动画集成到你的个人网站或博客中。

### 文件依赖

确保你的项目中包含 `signature-player.js` 和你导出的 `.json` 数据文件。

### 代码示例

```html
<div id="my-signature" style="width: 300px;"></div>

<script type="importmap">
  {
    "imports": {
      "react": "[https://esm.sh/react@18.2.0](https://esm.sh/react@18.2.0)",
      "react-dom/client": "[https://esm.sh/react-dom@18.2.0/client](https://esm.sh/react-dom@18.2.0/client)"
    }
  }
</script>

<script type="module">
  import { mountSignature } from "./signature-player.js";

  // 参数1: 容器 ID 或 DOM 元素
  // 参数2: JSON 数据文件的路径
  // 参数3: 配置对象 (可选)
  mountSignature("my-signature", "./your-export-file.json", {
    loop: false,      // 设置为 false 则写完即停，不进行循环擦除
    duration: 800,    // 单个笔画书写耗时(ms)，数值越小写得越快
    loopDelay: 3000   // 如果开启循环，写完后停留多久(ms)
  });
</script>